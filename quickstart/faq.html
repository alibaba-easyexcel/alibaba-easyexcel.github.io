<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">

    <title>Alibaba Easy Excel - 简单、省内存的Java解析Excel工具 | FAQ </title>
    <meta name="description" content>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/images/favicon.ico">

    

  </head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"title":"FAQ","path":"quickstart/faq.html"},"data":{"navigation":{"logo":{"text":"Easy Excel","type":"link","path":"index.html"},"main":[{"text":"首页","type":"link","path":"index.html"},{"text":"快速开始","type":"label"},{"text":"常见问题（建议先阅读这个）","type":"link","path":"quickstart/faq.html"},{"text":"读Excel","type":"link","path":"quickstart/read.html"},{"text":"写Excel","type":"link","path":"quickstart/write.html"},{"text":"填充Excel","type":"link","path":"quickstart/fill.html"},{"text":"常见api","type":"link","path":"quickstart/api.html"},{"text":"支持和反馈","type":"label"},{"text":"关于EasyExcel","type":"link","path":"support/about.html"},{"text":"在github上面留言","type":"link","path":"https://github.com/alibaba/easyexcel/issues/new/choose"}]}},"config":{"timezone":"UTC","root":"/","time_format":"HH:mm:ss","theme":"../node_modules/hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot><nav class="doc-navbar"><a href="/index.html" class="doc-navbar__logo"><img src="/images/logo.png" class="doc-navbar__logo__img"><span class="doc-navbar__logo__text">Easy Excel</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1><h2 id="读取文件务必使用2-0-3"><a href="#读取文件务必使用2-0-3" class="headerlink" title="读取文件务必使用2.0.3+"></a>读取文件务必使用2.0.3+</h2><p>2.0.0-beta1到2.0.2有小概率会丢失数字。</p>
<h2 id="不支持功能"><a href="#不支持功能" class="headerlink" title="不支持功能"></a>不支持功能</h2><ul>
<li>单个文件的并发写入、读取</li>
<li>读取图片</li>
<li>宏</li>
<li>csv读取（这个后续可能会考虑）<h2 id="常见问题-1"><a href="#常见问题-1" class="headerlink" title="常见问题"></a>常见问题</h2></li>
<li>关于@Data，读写的对象都用到了<a href="https://www.projectlombok.org/" target="_blank" rel="noopener">Lombok</a>,他会自动生成<code>get</code>,<code>set</code> ，如果不需要的话，自己创建对象并生成<code>get</code>,<code>set</code> 。</li>
<li>出现<code>NoSuchMethodException</code>，<code>ClassNotFoundException</code>,<code>NoClassDefFoundError</code>极大概率是jar冲突，建议<code>clean</code>项目，或者统一<code>poi</code> 的版本，理论上来说<code>easyexcel</code>兼容poi的<code>3.17</code>,<code>4.0.1</code>,<code>4.1.0</code>所有较新版本</li>
<li>如果在读的时候<code>Listener</code>里面需要使用spring的<code>@Autowired</code>，给<code>Listener</code>创建成员变量，然后在构造方法里面传进去。而别必须不让spring管理<code>Listener</code>，每次读取都要<code>new</code>一个。</li>
<li>如果用<code>String</code>去接收数字，出现小数点等情况，这个是BUG，但是很难修复，后续版本会修复这个问题。目前请使用<code>@NumberFormat</code>注解，里面的参数就是调用了java自带的<code>NumberFormat.format</code>方法，不知道怎么入参的可以自己网上查询。<h2 id="超大-10M以上-文件读取说明"><a href="#超大-10M以上-文件读取说明" class="headerlink" title="超大(10M以上)文件读取说明"></a>超大(10M以上)文件读取说明</h2>03版没有办法处理，相对内存占用大很多。excel 07版本有个共享字符串<a href="https://docs.microsoft.com/zh-cn/office/open-xml/working-with-the-shared-string-table" target="_blank" rel="noopener">共享字符串</a>的概念，这个会非常占用内存，如果全部读取到内存的话，大概是excel文件的大小的3-10倍，所以easyexcel用存储文件的，然后再反序列化去读取的策略来节约内存。当然需要通过文件反序列化以后，效率会降低，大概降低30-50%（不一定，也看命中率，可能会超过100%）<h4 id="如果对读取效率感觉还能接受，就用默认的，永久占用（单个excel读取整个过程）一般不会超过50M-大概率就30M-，剩下临时的GC会很快回收"><a href="#如果对读取效率感觉还能接受，就用默认的，永久占用（单个excel读取整个过程）一般不会超过50M-大概率就30M-，剩下临时的GC会很快回收" class="headerlink" title="如果对读取效率感觉还能接受，就用默认的，永久占用（单个excel读取整个过程）一般不会超过50M(大概率就30M)，剩下临时的GC会很快回收"></a>如果对读取效率感觉还能接受，就用默认的，永久占用（单个excel读取整个过程）一般不会超过50M(大概率就30M)，剩下临时的GC会很快回收</h4><h4 id="默认大文件处理"><a href="#默认大文件处理" class="headerlink" title="默认大文件处理"></a>默认大文件处理</h4>默认大文件处理会自动判断，共享字符串5M以下会使用内存存储，大概占用15-50M的内存,超过5M则使用文件存储，然后文件存储也要设置多内存M用来存放临时的共享字符串，默认20M。除了共享字符串占用内存外，其他占用较少，所以可以预估10M，所以默认大概30M就能读取一个超级大的文件。<h3 id="根据实际需求配置内存"><a href="#根据实际需求配置内存" class="headerlink" title="根据实际需求配置内存"></a>根据实际需求配置内存</h3>想自定义设置，首先要确定你大概愿意花多少内存来读取一个超级大的excel,比如希望读取excel最多占用100M内存（是读取过程中永久占用，新生代马上回收的不算），那就设置使用文件来存储共享字符串的大小判断为20M(小于20M存内存，大于存临时文件)，然后设置文件存储时临时共享字符串占用内存大小90M差不多<h4 id="如果最大文件条数也就十几二十万，然后excel也就是十几二十M，而且不会有很高的并发，并且内存也较大"><a href="#如果最大文件条数也就十几二十万，然后excel也就是十几二十M，而且不会有很高的并发，并且内存也较大" class="headerlink" title="如果最大文件条数也就十几二十万，然后excel也就是十几二十M，而且不会有很高的并发，并且内存也较大"></a>如果最大文件条数也就十几二十万，然后excel也就是十几二十M，而且不会有很高的并发，并且内存也较大</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 强制使用内存存储，这样大概一个20M的excel使用150M（很多临时对象，所以100M会一直GC）的内存</span></span><br><span class="line"><span class="comment">// 这样效率会比上面的复杂的策略高很多</span></span><br><span class="line">   <span class="comment">// 这里再说明下 就是加了个readCache(new MapCache()) 参数而已，其他的参照其他demo写 这里没有写全 </span></span><br><span class="line">  EasyExcel.read().readCache(<span class="keyword">new</span> MapCache());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="对并发要求较高，而且都是经常有超级大文件"><a href="#对并发要求较高，而且都是经常有超级大文件" class="headerlink" title="对并发要求较高，而且都是经常有超级大文件"></a>对并发要求较高，而且都是经常有超级大文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 第一个参数的意思是 多少M共享字符串以后 采用文件存储 单位MB 默认5M</span></span><br><span class="line"><span class="comment">// 第二个参数 文件存储时，内存存放多少M缓存数据 默认20M</span></span><br><span class="line"><span class="comment">// 比如 你希望用100M内存(这里说的是解析过程中的永久占用,临时对象不算)来解析excel，前面算过了 大概是 20M+90M 所以设置参数为:20 和 90 </span></span><br><span class="line">   <span class="comment">// 这里再说明下 就是加了个readCacheSelector(new SimpleReadCacheSelector(5, 20))参数而已，其他的参照其他demo写 这里没有写全 </span></span><br><span class="line">EasyExcel.read().readCacheSelector(<span class="keyword">new</span> SimpleReadCacheSelector(<span class="number">5</span>, <span class="number">20</span>));</span><br></pre></td></tr></table></figure>
<h4 id="关于maxCacheActivateSize-也就是前面第二个参数的详细说明"><a href="#关于maxCacheActivateSize-也就是前面第二个参数的详细说明" class="headerlink" title="关于maxCacheActivateSize 也就是前面第二个参数的详细说明"></a>关于maxCacheActivateSize 也就是前面第二个参数的详细说明</h4><p>easyexcel在使用文件存储的时候，会把共享字符串拆分成1000条一批，然后放到文件存储。然后excel来读取共享字符串大概率是按照顺序的，所以默认20M的1000条的数据放在内存，命中后直接返回，没命中去读文件。所以不能设置太小，太小了，很难命中，一直去读取文件，太大了的话会占用过多的内存。</p>
<h4 id="如何判断-maxCacheActivateSize是否需要调整"><a href="#如何判断-maxCacheActivateSize是否需要调整" class="headerlink" title="如何判断 maxCacheActivateSize是否需要调整"></a>如何判断 maxCacheActivateSize是否需要调整</h4><p>开启debug日志会输出<code>Already put :4000000</code> 最后一次输出，大概可以得出值为400W,然后看<code>Cache misses count:4001</code>得到值为4K，400W/4K=1000 这代表已经<code>maxCacheActivateSize</code> 已经非常合理了。如果小于500 问题就非常大了，500到1000 应该都还行。</p>

        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script>

    

  </body>
</html>
